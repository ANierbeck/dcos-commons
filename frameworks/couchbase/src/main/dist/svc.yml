name: {{FRAMEWORK_NAME}}
pods:
  couchbase:
    uris: 
      - https://packages.couchbase.com/releases/4.5.1/couchbase-server-enterprise-4.5.1-centos7.x86_64.rpm
    count: {{COUCHBASE_COUNT}}
    container:
      image-name: centos
      rlimits:
        RLIMIT_NOFILE:
          soft: 40960
          hard: 40960
        RLIMIT_CORE:
          soft: 15728640
          hard: 15728640  
    tasks:
      server:
        goal: RUNNING
        cmd: >
          cd $MESOS_SANDBOX/couchbase-container-path &&
          mkdir -p var/lib/couchbase var/lib/couchbase/crash var/lib/couchbase/config var/lib/couchbase/stats var/lib/couchbase/index var/lib/couchbase/logs var/lib/couchbase/data var/lib/moxi &&
          cd .. &&
          yum -y install openssl &&
          rpm -i couchbase-server-enterprise-4.5.1-centos7.x86_64.rpm &&
          chown -R couchbase:couchbase $MESOS_SANDBOX/couchbase-container-path/var &&
          cd /opt/couchbase/var/lib/couchbase &&
          rm -rf config/ stats/ logs/ crash/ data/ &&
          ln -s $MESOS_SANDBOX/couchbase-container-path/var/lib/couchbase/config config &&
          ln -s $MESOS_SANDBOX/couchbase-container-path/var/lib/couchbase/logs logs &&
          ln -s $MESOS_SANDBOX/couchbase-container-path/var/lib/couchbase/stats stats &&
          ln -s $MESOS_SANDBOX/couchbase-container-path/var/lib/couchbase/data data &&
          ln -s $MESOS_SANDBOX/couchbase-container-path/var/lib/couchbase/index index &&
          ln -s $MESOS_SANDBOX/couchbase-container-path/var/lib/couchbase/crash crash &&
          cd .. &&
          ln -s $MESOS_SANDBOX/couchbase-container-path/var/lib/moxi moxi &&
          /opt/couchbase/bin/couchbase-server -- -noinput -detached
        cpus: {{COUCHBASE_CPUS}}
        memory: {{COUCHBASE_MEM}}
        volume:
          path: couchbase-container-path
          type: ROOT
          size: {{COUCHBASE_DISK}}
